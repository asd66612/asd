name: WireGuard workflow
on:
  push:
    branches: [ main ]

jobs:
  setup-wireguard:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup WireGuard
        uses: wenoa/setup-wireguard@v1.0.0
        with:
          WG_CONFIG: |
            [Interface]
            Address = 10.0.0.1/24
            ListenPort = 51820
            PrivateKey = <CLIENT_PRIVATE_KEY>
            MTU = 1420
            PostUp = sysctl -w net.ipv4.ip_forward=1; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
            PostDown = iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE; sysctl -w net.ipv4.ip_forward=0

            [Peer]
            PublicKey = 4qdIgJdpEoRbC/XvNo28uhhg2cO0KWMac4JlIlZrN08=
            AllowedIPs = 10.0.0.2/32

      - name: Show public IP
        run: |
          curl -s https://ipinfo.io/ip
